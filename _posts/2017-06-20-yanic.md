---
layout: post
title:  "Monitoring im Freifunk (Yanic)"
author: genofire
date:   2017-06-20 17:41:17 +0200
---
Mit der neuen Webseite hat sich auch vieles im Bereich Monitoring ver√§ndert.


## Hintergrund
In der Vergangenheit gab es die Software Alfred, um von den Knoten Information zu bekommen.
Doch diese Software wird von Gluon aus technischen Gr√ºnden bald nicht mehr weiter eingesetzt.
Bereits Anfang letzten Jahres wurde in Gluon mit der neuen [Statusseite der Knoten](http://node.ffhb.de) einiges an der Bereitstellung von Information umgebaut.
Die dadurch entstandene Software **respondd** wird genutzt, um Nachbarknoten zu finden und die Statusseite zu f√ºllen.


## Entwicklung
Durch den unausgesprochenen Status, dass Alfred veraltet ist, musste nun ein Ersatz her.
Hierf√ºr kamen [corny](https://github.com/corny) und [ich](https://github.com/genofire) auf die Idee, daf√ºr eine Software zu entwickeln.
Die Wahl der Sprache fiel auf [Go](https://golang.org/), da sie sich f√ºr nebenl√§ufige Netzwerkanwendungen bestens eignet.

Als Datenbank zum Abspeichern der Werte entschieden wir uns f√ºr [InfluxDB](https://docs.influxdata.com/influxdb/latest/).
Sie ist zum Abspeichern von Messwerten √ºber Zeit gedacht, benutzt eine Sprache angelehnt an SQL und bietet eine Bibliothek f√ºr Go.
Zudem sollte die Software auch die M√∂glichkeit bieten, die Daten f√ºr die bisherige [Kartensoftware](https://github.com/ffnord/meshviewer) aufbereitet zu liefern.
Au√üerdem sollte sie zukunftssicher geschrieben worden sein, damit sie einfach erweitert werden kann, um die eingesammelten Daten f√ºr m√∂glicherweise noch kommende weitere Software zur Visualisierung bereitzustellen.

Letztes Jahr auf der [Breminale](/blog/2016/08/09/breminale-r√ºckblick.html) fand der erste gro√üe Test statt.
Dort erf√ºllte die Software ihre Aufgabe bereits sehr gut.
Es sind allerdings kleine Probleme aufgetaucht, die den direkten Einsatz im Freifunk Bremen verz√∂gerten.
Die bestanden haupts√§chlich aus zeitlicher Verarbeitung.
Dies lag vor allem an der verbindungslosen Kommunikation, mit der respondd Daten austauscht.
Um diese Probleme noch genauer und √ºber einen l√§ngeren Zeitraum zu beobachten, haben wir zun√§chst eine kleine Instanz zum Entwickeln im Bremer Freifunk-Netz aufgesetzt.
Zur L√∂sung f√ºhren nun verschiedene Mechanismen in unserer Software.
Doch auch die Gluon-Entwickler haben unabh√§ngig von uns in respondd eine [Verbesserung](https://github.com/freifunk-gluon/packages/pull/140) f√ºr dieses Problem implementiert.

Zum Zeitpunkt der Ver√∂ffentlichung der neuen Webseite hielten wir unsere Software f√ºr ausgereift genug, um sie mit der neuen Webseite vorrangig einzusetzen und damit Alfred bei uns zu ersetzen.


Der umst√§ndliche Name `respondd-collector` wurde auf Wunsch vieler Freifunker und nach l√§ngerer [Diskussion](https://github.com/FreifunkBremen/yanic/issues/24) ge√§ndert.
Der neue Name *Yanic* steht f√ºr ‚ÄûYet another node info collector‚Äú, da gleichzeitig auch in anderen Communities √§hnliche Software entstanden ist.
Eine vergleichbare Software ist [HopGlass Server](https://github.com/hopglass/hopglass-server).


### Auswirkung unserer Entwicklung auf andere Communities
Nach einem gr√∂√üeren Refactoring ist Yanic nun modular und unterst√ºtzt unterschiedliche Datenbanksysteme.
In der [GPN17](https://entropia.de/GPN17) hat der Freifunker andir [Graphite-Support](https://github.com/FreifunkBremen/yanic/pull/65) integriert.

Denn durch die moderne grafische Aufbereitung mit Grafana,
haben ein paar Communities bereits Interesse an unserer Software ge√§u√üert.
Nach aktuellem Wissensstand nutzen folgende Communities bereits Yanic:
- [Freifunk Regensburg](https://regensburg.freifunk.net/meshviewer/)
- [Freifunk im Ennepe-Ruhr-Kreis](https://map.ff-en.de/graph/dashboard/db/freifunk-en-clientstatistik)
- [Freifunk Frankfurt am Main](https://ffm.freifunk.net/2017/05/10/wartungsarbeiten-beendet/)
- [Freifunk Hannover](https://stats.ffh.zone/)
- [Freifunk Hochstift](https://map.hochstift.freifunk.net)
- [Freifunk in Mainz, Wiesbaden & Umgebung](https://blog.freifunk-mainz.de/tag/karte/)
- [Freifunk Uelzen](https://www.freifunk-uelzen.de/2017/05/06/kartenserver/)
- [Freifunk Gera Greiz](https://www.freifunk-gera-greiz.de/grafana/dashboard/db/knoten-statistik)
- [Freifunk Westpfalz](https://stats.freifunk-westpfalz.de/)
- und wahrscheinlich viele, von den wir es nicht wissen üòÉ

Auch die freundschaftliche Konkurrenz, die nach Alfred nun an Hopglass entwickeln,
√§u√üern mit einem Fork Interesse an [Yanic](https://github.com/hopglass/yanic).

## Darstellung als Graphen
Wie bereits erw√§hnt, ist Grafana ein sehr gutes und modernes Tool zur Darstellung von Graphen.
Hier mal eine, um h√∂chstens f√ºnf Minuten verz√∂gerte, Live-Darstellung unseres Netzes direkt von [Grafana](https://grafana.bremen.freifunk.net/):

<img src="https://grafana.bremen.freifunk.net/render/dashboard-solo/db/globals?panelId=2&orgId=1&from=now-23h&to=now&width=1000&height=500&theme=light"/>

Dies und vieles mehr kann man nun mit den eingesammelten Daten tun. Ihr d√ºrft Euch auch gerne dort mal austoben, eine Registrierung ist nicht notwendig. Der Benutzer lautet ‚Äûffhb‚Äú und das Passwort ‚Äûwellenfunk‚Äú, doch bitte beachtet folgende Regeln:  
Lasst Eure Dashboards mit ‚Äû[Privat]‚Äú anfangen, und ver√§ndert keine Dashboards von anderen. Fragt bei den Dashboards ohne ‚Äû[Privat]‚Äú den Rest der Bremer Community (die man gern im IRC, Mailingliste oder auf ein Treffen erreicht) *bevor* ihr sie ver√§ndert.<br/>
*(Falls diese Regeln nicht funktionieren, m√ºssen wir leider eine verpflichtende Authentifizierung einf√ºhren.)*

### Tipp
Es wurde oft angeregt eine Software einzurichten, welche einen beim Ausfall seines Knotens benachrichtigt.
Dies ist tats√§chlich mit Grafana sehr rudiment√§r (und etwas kompliziert) m√∂glich,
indem man unter Alerting einen eigenen E-Mail-Eintrag erstellt.
Daraufhin setzt man auf sein Dashboard in einem Graphen als Alert einen Grenzwert und eine Benachrichtigung zu seinem zuvor angegeben Kontakt.<br/>
*Beachtet: Die E-Mail-Adressen sind frei zug√§nglich. Au√üerdem k√∂nnten durch ‚ÄûSchwankungen‚Äú im Freifunk viele E-Mails ankommen.*


Die offizielle Anleitung von Grafana auf [Englisch](https://grafana.com/docs/grafana/latest/alerting/create-alerts/).

---
*Tut mir leid, dass es zu diesem Thema erst jetzt einen Beitrag gibt.
Die Entwicklung von Yanic nimmt sehr viel Zeit in Anspruch, wodurch ich auch in anderen Freifunk Angelegenheiten etwas weniger pr√§sent bin.*

Ihr k√∂nnt Euch schon mal freuen, dass hoffentlich bald einen weiteren Beitrag zur aktuellen [Karte](https://map.bremen.freifunk.net) geben wird!
